<wxs module="TIME" src="/utils/filters/time.wxs" />

<view class="header {{headerVisible ? 'show' : ''}}" style="padding-top: {{statusBarHeight}}px">
  <view class="nav-bar row">
    <back-icon />
    <view class="title" wx:if="{{headerVisible}}">家乡代言人</view>
  </view>
</view>

<view class="container">
  <view class="promoter-info-wrap" style="margin-top: {{statusBarHeight + 128}}px;">
    <view class="promoter-avatar-wrap">
      <image class="promoter-avatar" src="{{superiorInfo.avatar || 'https://static.tiddler.cn/mp/default_avatar.png'}}?x-oss-process=image/format,webp" />
      <image 
        class="promoter-medal" 
        wx:if="{{superiorInfo}}" 
        src="https://static.tiddler.cn/mp/promoter/level_{{superiorInfo.promoterInfo.level}}/medal.gif" 
      />
    </view>
    <view class="promoter-name-wrap row between">
      <view class="promoter-name row">
        <view>{{superiorInfo.nickname}}</view>
        <view class="promoter-level level-{{superiorInfo.promoterInfo.level}} row">Lv.{{superiorInfo.promoterInfo.level}}</view>
      </view>
      <view class="qrcode-btn row center" wx:if="{{superiorInfo.id === userInfo.id}}" bindtap="showQrCode">
        我的二维码
      </view>
      <view class="contact-btns row" wx:if="{{superiorInfo.id !== userInfo.id}}">
        <view class="chat-btn row center" bindtap="contact">
          <image class="chat-icon" src="https://static.tiddler.cn/mp/promoter/center/chat.png" />
          <view>在线问</view>
        </view>
        <view class="tel-btn row center" bindtap="makePhoneCall">
          <image class="tel-icon" src="https://static.tiddler.cn/mp/promoter/center/tel.png" />
        </view>
      </view>
    </view>
    <view class="promoter-tags">
      <view class="promoter-tag row">本地人</view>
      <view class="promoter-tag row">热心市民</view>
      <view class="promoter-tag row" wx:for="{{tagList}}" wx:key="index">
        <text>{{item.content}}</text>
        <text wx:if="{{item.count > 1}}" style="margin-left: 8rpx">{{item.count}}</text>
      </view>
    </view>
    <view class="promoter-data row">
      <image class="star-icon" src="https://static.tiddler.cn/mp/promoter/center/star.png" />
      <view class="data">{{avgScore || '--'}}</view>
      <view class="split-line">/</view>
      <view>回答数</view>
      <view class="data">{{answerCount || '--'}}</view>
      <view class="split-line">/</view>
      <view>平均响应</view>
      <view class="data">{{averageDuration ? TIME.formatReplyTime(averageDuration) : '--'}}</view>
    </view>
  </view>

  <view class="menu row">
    <view 
      class="menu-item {{curMenuIdx === index ? 'active' : ''}}" 
      wx:for="{{['问答', '评价']}}" 
      wx:key="index"
      bindtap="selectMenu"
      data-index="{{index}}"
    >
      {{item}}
    </view>
  </view>

  <view class="qa-wrap" wx:if="{{curMenuIdx === 0}}">
    <qa-item 
      wx:for="{{qaList}}" 
      wx:key="index" 
      item="{{item}}" 
      showBorder="{{index}}" 
      isPromoter="{{superiorInfo.id === userInfo.id}}" 
      bind:answer="answer"
    />
    <empty-illus wx:if="{{!qaList.length}}" desc="暂无问答" height="520rpx" />
  </view>

  <view class="evaluation-wrap" wx:if="{{curMenuIdx === 1}}">
    <evaluation-item 
      wx:for="{{evaluationList}}" 
      wx:key="index" 
      item="{{item}}" 
      showBorder="{{index}}" 
    />
    <empty-illus wx:if="{{!evaluationList.length}}" desc="暂无评价" height="520rpx" />
  </view>

  <view class="complaint-tips row center" wx:if="{{superiorInfo.id !== userInfo.id}}" bindtap="complain">
    <view>投诉TA</view>
    <image class="tips-arrow" src="/images/arrow_gray.png" />
  </view>
</view>

<view 
  class="submit-btn row center" 
  wx:if="{{superiorInfo.id !== userInfo.id}}"
  bindtap="interact"
>
  {{curMenuIdx === 0 ? '我要提问' : '评价一下'}}
</view>

<modal-mask wx:if="{{inputPopupVisible || qrCodeVisible}}" catchtap="hidePopup" />
<input-popup 
  wx:if="{{inputPopupVisible}}" 
  promoterId="{{superiorInfo.id}}" 
  questionId="{{curQuestionId}}" 
  bind:finish="finishInput"
/>

<view class="qr-code-modal">
  <image class="qr-code" wx:if="{{qrCodeVisible}}" src="{{qrCode}}" show-menu-by-longpress />
  <image class="close-icon" catchtap="hideQrCode" src="https://static.tiddler.cn/mp/home/close_icon.webp" />
</view>
